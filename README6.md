# Кэширование

## Подключил кэш для активной валюты

Используется в командах:

* создание траты
* формирование отчета
* запрос активной валюты
* запроса лимита
* установка лимита

## Подключил кэш для рапортов

В кэше держу три рапорта (недельный, месячный, годовой = userid_W, userid_M, userid_Y). Тогда сложность останется O(1)

Валидация:

1. При добавлении траты

* Если дата траты > (now()-год) -> протухает годовой
* Если дата траты > (now()-месяц) -> протухает месячный рапорт
* Если дата траты > (now()-неделя) -> протухает недельный рапорт

2. Еще рапорты протухают со временем, если дата самой старой траты, учтенной в рапорте, выходит за рамки запроса. Поэтому при запросе рапорта надо отдельно эту дату сохранять в кэше, при формировании:

* запрашиваем, если эта дата еще валидна - отдаем кэш
* если в кэше ничего нет или дата просрочена - формируем отчет из бд + пишем в кэш

Сначала я кэш для рапортов хранил в виде уже отрендеренного string, но при смене валюты кэш отдавал не то. Поменял на структуру Report и провожу рендер каждый раз (там запрос текущей валюты и курса, все без обращения к БД)
